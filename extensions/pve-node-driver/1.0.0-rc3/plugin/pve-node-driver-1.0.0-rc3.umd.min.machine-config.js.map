{"version":3,"file":"pve-node-driver-1.0.0-rc3.umd.min.machine-config.js","mappings":"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","sources":["webpack://pve-node-driver-1.0.0-rc3/./machine-config/pve.vue","webpack://pve-node-driver-1.0.0-rc3/./machine-config/pve.vue?9f4d"],"sourcesContent":["<script>\nimport { SECRET } from '@shell/config/types';\nimport { LabeledInput } from '@components/Form/LabeledInput';\nimport LabeledSelect from '@shell/components/form/LabeledSelect';\n\nexport default {\n  components: {\n    LabeledInput,\n    LabeledSelect,\n  },\n  props: {\n    mode: {\n      type:     String,\n      required: true,\n    },\n    value: {\n      type:     Object,\n      required: true,\n    },\n    credentialId: {\n      type:     String,\n      required: true,\n    },\n  },\n  data(){\n    return {\n      // Count of currently running external data fetches.\n      fetchingCount: 0,\n\n      // Cloud credential data.\n      credential: null,\n\n      // Available Proxmox VE resource pools.\n      resourcePools: null,\n\n      // Available Proxmox VE templates in current resource pool.\n      templates: null,\n\n      // Available devices on current Proxmox VE template.\n      devices: null,\n\n      // Current input values.\n      currentValue: {\n        resourcePool: this.value.resourcePool ?? '',\n        template: this.value.template ? parseInt(this.value.template) : 0,\n        isoDevice: this.value.isoDevice ?? '',\n        networkInterface: this.value.networkInterface ?? '',\n        sshUser: this.value.sshUser ? this.value.sshUser : 'service',\n        sshPort: this.value.sshPort ? parseInt(this.value.sshPort) : 22,\n      },\n    }\n  },\n  created(){\n    this.validate();\n  },\n  async fetch(){\n    await this.fetchCredential();\n    await this.fetchResourcePools();\n    await this.fetchTemplates();\n    await this.fetchDevices();\n  },\n  watch: {\n    async credentialId(){\n      await this.$fetch();\n      this.validate();\n    },\n    'currentValue.resourcePool': async function (){\n      await this.fetchTemplates();\n      await this.fetchDevices();\n    },\n    'currentValue.template': async function (){\n      await this.fetchDevices();\n    },\n    currentValue: {\n      deep: true,\n      handler(){\n        this.validate();\n      },\n    },\n    resourcePools(){\n      if(this.resourcePools == null) {\n        return\n      }\n\n      if(this.resourcePools.length == 1) {\n        this.currentValue.resourcePool = this.resourcePools[0];\n      }\n\n      if(!this.resourcePools.includes(this.currentValue.resourcePool)) {\n        this.currentValue.resourcePool = '';\n      }\n    },\n    templates(){\n      if(this.templates == null) {\n        return\n      }\n\n      if(this.templates.length == 1) {\n        this.currentValue.template = this.templates[0].vmid;\n      }\n\n      const currentTemplate = this.templates.find(template => this.currentValue.template == template.vmid)\n\n      if(!currentTemplate) {\n        this.currentValue.template = 0;\n      }\n    },\n    isoDeviceSelectOptions(){\n      if(this.isoDeviceSelectOptions == null) {\n        return\n      }\n\n      if(this.isoDeviceSelectOptions.length == 1) {\n        this.currentValue.isoDevice = this.isoDeviceSelectOptions[0];\n      }\n\n      if(!this.isoDeviceSelectOptions.includes(this.currentValue.isoDevice)) {\n        this.currentValue.isoDevice = '';\n      }\n    },\n    networkInterfaceSelectOptions(){\n      if(this.networkInterfaceSelectOptions == null) {\n        return\n      }\n\n      if(this.networkInterfaceSelectOptions.length == 1) {\n        this.currentValue.networkInterface = this.networkInterfaceSelectOptions[0];\n      }\n\n      if(!this.networkInterfaceSelectOptions.includes(this.currentValue.networkInterface)) {\n        this.currentValue.networkInterface = '';\n      }\n    },\n  },\n  methods: {\n    validate(){\n      // Sanity check current value\n      if(this.currentValue.resourcePool == '') {\n        this.$emit('validationChanged', false);\n        return\n      }\n\n      if(this.currentValue.template < 1) {\n        this.$emit('validationChanged', false);\n        return\n      }\n\n      if(this.currentValue.isoDevice == '') {\n        this.$emit('validationChanged', false);\n        return\n      }\n\n      if(this.currentValue.networkInterface == '') {\n        this.$emit('validationChanged', false);\n        return\n      }\n\n      if(this.currentValue.sshUser == '') {\n        this.$emit('validationChanged', false);\n        return\n      }\n\n      if(this.currentValue.sshPort < 1) {\n        this.$emit('validationChanged', false);\n        return\n      }\n\n      // Copy current value to the 'value' prop\n      this.value.resourcePool = this.currentValue.resourcePool;\n      this.value.template = this.currentValue.template.toString();\n      this.value.isoDevice = this.currentValue.isoDevice;\n      this.value.networkInterface = this.currentValue.networkInterface;\n      this.value.sshUser = this.currentValue.sshUser;\n      this.value.sshPort = this.currentValue.sshPort.toString();\n\n      this.$emit('validationChanged', true);\n    },\n    async fetchCredential(){\n      try {\n        this.fetchingCount += 1;\n\n        const secret = await this.$store.dispatch('management/find', {\n          type: SECRET,\n          id: this.credentialId.replace(':', '/'),\n        });\n\n        const decodedData = {\n          url: atob(secret.data['pvecredentialConfig-url']),\n          insecureTls: atob(secret.data['pvecredentialConfig-insecureTls']) == 'true',\n          tokenId: atob(secret.data['pvecredentialConfig-tokenId']),\n          tokenSecret: atob(secret.data['pvecredentialConfig-tokenSecret']),\n        }\n\n        if(decodedData.insecureTls) {\n          // If insecure TLS is enabled then we don't have ability to call Proxmox VE from the UI.\n          throw new Error('Insecure TLS is enabled')\n        }\n        \n        this.credential = decodedData;\n      } catch(e) {\n        console.warn(\"Failed to fetch Proxmox VE credential, enhanced form fields are disabled\", e)\n        this.credential = null;\n      } finally {\n        this.fetchingCount -= 1;\n      }\n    },\n    async fetchResourcePools(){\n      try {\n        this.fetchingCount += 1;\n\n        const { data } = await this.fetchFromProxmox('/api2/json/pools');\n\n        this.resourcePools = data.map(pool => pool.poolid);\n      } catch(e) {\n        this.resourcePools = null;\n      } finally {\n        this.fetchingCount -= 1;\n      }\n    },\n    async fetchTemplates(){\n      if(this.credential == null) {\n        this.templates = null;\n        return;\n      }\n\n      if(this.resourcePools && this.currentValue.resourcePool == '') {\n        this.templates = [];\n        return;\n      }\n\n      try {\n        this.fetchingCount += 1;\n\n        if(!this.currentValue.resourcePool) {\n          throw new Error('Resource pool is not selected')\n        }\n\n        const { data } = await this.fetchFromProxmox(`/api2/json/pools?type=qemu&poolid=${this.currentValue.resourcePool}`);\n        \n        this.templates = data[0].members.filter(vm => vm.template == 1);\n      } catch(e) {\n        this.templates = null;\n      } finally {\n        this.fetchingCount -= 1;\n      }\n    },\n    async fetchDevices(){\n      if(this.credential == null) {\n        this.devices = null;\n        return;\n      }\n\n      if(this.templates && this.currentValue.template == '') {\n        this.devices = [];\n        return;\n      }\n\n      try {\n        this.fetchingCount += 1;\n\n        if(!this.currentValue.template) {\n          throw new Error('Template is not selected');\n        }\n\n        const template = this.templates.find(template => this.currentValue.template == template.vmid);\n\n        if(!template) {\n          throw new Error(\"Template not found\")\n        }\n\n        const { data } = await this.fetchFromProxmox(`/api2/json/nodes/${template.node}/qemu/${template.vmid}/pending`);\n        \n        this.devices = data;\n      } catch(e) {\n        this.devices = null;\n      } finally {\n        this.fetchingCount -= 1;\n      }\n    },\n    fetchFromProxmox(apiPath){\n      if(this.credential == null) {\n        throw new Error(\"Credential not available\")\n      }\n\n      return this.$store.dispatch('management/request', {\n        method: 'GET',\n        url: '/meta/proxy/' + this.credential.url.replace(/^https?:\\/\\//, '') + apiPath,\n        headers: {\n          \"X-API-Auth-Header\": `PVEAPIToken=${this.credential.tokenId}=${this.credential.tokenSecret}`,\n        },\n        redirectUnauthorized: false,\n      })\n    },\n    selectTemplate(option) {\n      if(Object.keys(this.templateSelectOptions).length == 0) {\n        this.currentValue.template = 0;\n        return;\n      }\n\n      for (const [vmid, name] of Object.entries(this.templateSelectOptions)) {\n        if(option == name) {\n          this.currentValue.template = vmid;\n          return;\n        }\n      }\n\n      this.currentValue.template = 0;\n    },\n  },\n  computed: {\n    disabled(){\n      return this.fetchingCount > 0\n    },\n    templateSelectOptions() {\n      if(this.templates === null) {\n        return {};\n      }\n\n      return this.templates.reduce(\n        (templates, template) => ({...templates, [template.vmid]: `${template.name} (${template.vmid})`}),\n        {},\n      );\n    },\n    templateSelectValue() {\n      return this.templateSelectOptions[this.currentValue.template] ?? '';\n    },\n    isoDeviceSelectOptions() {\n      if(this.devices == null) {\n        return null;\n      }\n\n      return this.devices\n        .filter(device => device.key)\n        .filter(device => (device.value && typeof device.value == \"string\"))\n        .filter(device => device.value.includes('media=cdrom'))\n        .map(device => device.key);\n    },\n    networkInterfaceSelectOptions() {\n      if(this.devices == null) {\n        return null;\n      }\n\n      return this.devices\n        .filter(device => device.key)\n        .filter(device => device.key.startsWith('net'))\n        .map(device => device.key);\n    },\n  },\n}\n</script>\n\n<template>\n  <div class=\"mt-20 mb-20\">\n    <!-- Resource pool  -->\n    <LabeledInput\n      v-if=\"resourcePools == null\"\n      type=\"text\"\n      :mode=\"mode\"\n      :disabled=\"disabled\"\n      :value=\"currentValue.resourcePool\"\n      @change=\"e => { currentValue.resourcePool = e.target.value}\"\n      label-key=\"cluster.machineConfig.pve.resourcePool.label\"\n      required\n    />\n\n    <LabeledSelect\n      v-else\n      :mode=\"mode\"\n      :disabled=\"disabled\"\n      v-model:value=\"currentValue.resourcePool\"\n      :options=\"resourcePools\"\n      label-key=\"cluster.machineConfig.pve.resourcePool.label\"\n      required\n    />\n\n    <!-- Template -->\n    <LabeledInput\n      v-if=\"templates == null\"\n      class=\"mt-20\"\n      type=\"number\"\n      :mode=\"mode\"\n      :disabled=\"disabled\"\n      :value=\"currentValue.template\"\n      @change=\"e => { currentValue.template = e.target.value}\"\n      label-key=\"cluster.machineConfig.pve.template.label\"\n      required\n      min=\"1\"\n      step=\"1\"\n    />\n\n    <LabeledSelect\n      v-else\n      class=\"mt-20\"\n      :mode=\"mode\"\n      :disabled=\"disabled || (resourcePools != null && !currentValue.resourcePool)\"\n      v-model:value=\"templateSelectValue\"\n      @option:selected=\"selectTemplate\"\n      :options=\"Object.values(templateSelectOptions)\"\n      label-key=\"cluster.machineConfig.pve.template.label\"\n      required\n    />\n\n    <h2 class=\"mt-20\">\n      <t k=\"cluster.machineConfig.pve.devices.header\" />\n    </h2>\n    <div class=\"row mt-20\">\n      <div class=\"col span-6\">\n        <!-- ISO Device -->\n        <LabeledInput\n          v-if=\"devices == null\"\n          type=\"text\"\n          :mode=\"mode\"\n          :disabled=\"disabled\"\n          :value=\"currentValue.isoDevice\"\n          @change=\"e => { currentValue.isoDevice = e.target.value}\"\n          label-key=\"cluster.machineConfig.pve.devices.iso.label\"\n          tooltip-key=\"cluster.machineConfig.pve.devices.iso.tooltip\"\n          required\n        />\n\n        <LabeledSelect\n          v-else\n          :mode=\"mode\"\n          :disabled=\"disabled || (templates != null && !currentValue.template)\"\n          v-model:value=\"currentValue.isoDevice\"\n          :options=\"isoDeviceSelectOptions\"\n          label-key=\"cluster.machineConfig.pve.devices.iso.label\"\n          tooltip-key=\"cluster.machineConfig.pve.devices.iso.tooltip\"\n          required\n        />\n      </div>\n      <div class=\"col span-6\">\n        <!-- Network interface -->\n        <LabeledInput\n          v-if=\"devices == null\"\n          type=\"text\"\n          :mode=\"mode\"\n          :value=\"currentValue.networkInterface\"\n          @change=\"e => { currentValue.networkInterface = e.target.value}\"\n          label-key=\"cluster.machineConfig.pve.devices.network.label\"\n          tooltip-key=\"cluster.machineConfig.pve.devices.network.tooltip\"\n          required\n        />\n\n        <LabeledSelect\n          v-else\n          :mode=\"mode\"\n          :disabled=\"disabled || (templates != null && !currentValue.template)\"\n          v-model:value=\"currentValue.networkInterface\"\n          :options=\"networkInterfaceSelectOptions\"\n          label-key=\"cluster.machineConfig.pve.devices.network.label\"\n          tooltip-key=\"cluster.machineConfig.pve.devices.network.tooltip\"\n          required\n        />\n      </div>\n    </div>\n\n    <h2 class=\"mt-20\">\n      <t k=\"cluster.machineConfig.pve.ssh.header\" />\n    </h2>\n    <div class=\"row mt-20\">\n      <div class=\"col span-6\">\n        <!-- SSH Username -->\n        <LabeledInput\n          type=\"text\"\n          :mode=\"mode\"\n          v-model:value=\"currentValue.sshUser\"\n          label-key=\"cluster.machineConfig.pve.ssh.username.label\"\n          tooltip-key=\"cluster.machineConfig.pve.ssh.username.tooltip\"\n          required\n        />\n      </div>\n      <div class=\"col span-6\">\n        <!-- SSH Port -->\n        <LabeledInput\n          type=\"number\"\n          :mode=\"mode\"\n          v-model:value=\"currentValue.sshPort\"\n          label-key=\"cluster.machineConfig.pve.ssh.port.label\"\n          tooltip-key=\"cluster.machineConfig.pve.ssh.port.tooltip\"\n          required\n          min=\"1\"\n          step=\"1\"\n        />\n      </div>\n    </div>\n\n  </div>\n</template>\n","import { render } from \"./pve.vue?vue&type=template&id=333301a4\"\nimport script from \"./pve.vue?vue&type=script&lang=js\"\nexport * from \"./pve.vue?vue&type=script&lang=js\"\n\nimport exportComponent from \"../../../node_modules/vue-loader/dist/exportHelper.js\"\nconst __exports__ = /*#__PURE__*/exportComponent(script, [['render',render]])\n\nexport default __exports__"],"names":["class","_createElementBlock","_hoisted_1","$data","resourcePools","_createBlock","_component_LabeledInput","key","type","mode","$props","disabled","$options","value","currentValue","resourcePool","onChange","_cache","e","target","required","_component_LabeledSelect","$event","options","templates","template","min","step","templateSelectValue","selectTemplate","Object","values","templateSelectOptions","_createElementVNode","_hoisted_2","_createVNode","_component_t","k","_hoisted_3","_hoisted_4","devices","isoDevice","isoDeviceSelectOptions","_hoisted_5","networkInterface","networkInterfaceSelectOptions","_hoisted_6","_hoisted_7","_hoisted_8","sshUser","_hoisted_9","sshPort","components","LabeledInput","LabeledSelect","props","String","credentialId","data","fetchingCount","credential","this","parseInt","created","validate","fetch","fetchCredential","fetchResourcePools","fetchTemplates","fetchDevices","watch","$fetch","async","deep","handler","length","includes","vmid","currentTemplate","find","methods","$emit","toString","secret","$store","dispatch","SECRET","id","replace","decodedData","url","atob","insecureTls","tokenId","tokenSecret","Error","console","warn","fetchFromProxmox","map","pool","poolid","members","filter","vm","node","apiPath","method","headers","redirectUnauthorized","option","keys","name","entries","computed","reduce","device","startsWith","__exports__","render"],"sourceRoot":""}