"use strict";(("undefined"!==typeof self?self:this)["webpackChunkpve_node_driver_1_1_0_rc1"]=("undefined"!==typeof self?self:this)["webpackChunkpve_node_driver_1_1_0_rc1"]||[]).push([[921],{6577:function(e,t,l){l.r(t),l.d(t,{default:function(){return D}});var r=l(9274);const o={class:"mt-20 mb-20"},s={class:"row mb-10"},a={class:"col span-6"},n={class:"col span-6"},i={class:"row mb-20"},c={class:"col span-6"},u={class:"col span-6"},m={class:"row mb-10"},d={class:"col span-6"},h={class:"col span-6"},p={class:"row mb-20"},v={class:"col span-6"},V={class:"row mb-20"},f={class:"col span-6"},y={class:"row"},k={class:"col span-6"},b={class:"col span-6"};function C(e,t,l,C,g,w){const S=(0,r.resolveComponent)("t"),P=(0,r.resolveComponent)("LabeledInput"),B=(0,r.resolveComponent)("LabeledSelect"),I=(0,r.resolveComponent)("UnitInput"),E=(0,r.resolveComponent)("portal");return(0,r.openBlock)(),(0,r.createElementBlock)("div",o,[(0,r.createElementVNode)("h3",null,[(0,r.createVNode)(S,{k:"cluster.machineConfig.pve.template.header"})]),(0,r.createElementVNode)("div",s,[(0,r.createElementVNode)("div",a,[null==g.resourcePools?((0,r.openBlock)(),(0,r.createBlock)(P,{key:0,type:"text",mode:l.mode,disabled:w.disabled,value:g.currentValue.resourcePool,onChange:t[0]||(t[0]=e=>{g.currentValue.resourcePool=e.target.value}),"label-key":"cluster.machineConfig.pve.template.resourcePool.label",required:""},null,8,["mode","disabled","value"])):((0,r.openBlock)(),(0,r.createBlock)(B,{key:1,mode:l.mode,disabled:w.disabled,value:g.currentValue.resourcePool,"onUpdate:value":t[1]||(t[1]=e=>g.currentValue.resourcePool=e),options:g.resourcePools,"label-key":"cluster.machineConfig.pve.template.resourcePool.label",required:""},null,8,["mode","disabled","value","options"]))]),(0,r.createElementVNode)("div",n,[null==g.templates?((0,r.openBlock)(),(0,r.createBlock)(P,{key:0,type:"number",mode:l.mode,disabled:w.disabled,value:g.currentValue.template,onChange:t[2]||(t[2]=e=>{g.currentValue.template=e.target.value}),"label-key":"cluster.machineConfig.pve.template.templateID.label",required:"",min:"1",step:"1"},null,8,["mode","disabled","value"])):((0,r.openBlock)(),(0,r.createBlock)(B,{key:1,mode:l.mode,disabled:w.disabled||null!=g.resourcePools&&!g.currentValue.resourcePool,value:w.templateSelectValue,"onUpdate:value":t[3]||(t[3]=e=>w.templateSelectValue=e),"onOption:selected":w.selectTemplate,options:Object.values(w.templateSelectOptions),"label-key":"cluster.machineConfig.pve.template.templateID.label",required:""},null,8,["mode","disabled","value","onOption:selected","options"]))])]),(0,r.createElementVNode)("div",i,[(0,r.createElementVNode)("div",c,[null==g.devices?((0,r.openBlock)(),(0,r.createBlock)(P,{key:0,type:"text",mode:l.mode,disabled:w.disabled,value:g.currentValue.isoDevice,onChange:t[4]||(t[4]=e=>{g.currentValue.isoDevice=e.target.value}),"label-key":"cluster.machineConfig.pve.template.iso.label","tooltip-key":"cluster.machineConfig.pve.template.iso.tooltip",required:""},null,8,["mode","disabled","value"])):((0,r.openBlock)(),(0,r.createBlock)(B,{key:1,mode:l.mode,disabled:w.disabled||null!=g.templates&&!g.currentValue.template,value:g.currentValue.isoDevice,"onUpdate:value":t[5]||(t[5]=e=>g.currentValue.isoDevice=e),options:w.isoDeviceSelectOptions,"label-key":"cluster.machineConfig.pve.template.iso.label","tooltip-key":"cluster.machineConfig.pve.template.iso.tooltip",required:""},null,8,["mode","disabled","value","options"]))]),(0,r.createElementVNode)("div",u,[null==g.devices?((0,r.openBlock)(),(0,r.createBlock)(P,{key:0,type:"text",mode:l.mode,value:g.currentValue.networkInterface,onChange:t[6]||(t[6]=e=>{g.currentValue.networkInterface=e.target.value}),"label-key":"cluster.machineConfig.pve.template.network.label","tooltip-key":"cluster.machineConfig.pve.template.network.tooltip",required:""},null,8,["mode","value"])):((0,r.openBlock)(),(0,r.createBlock)(B,{key:1,mode:l.mode,disabled:w.disabled||null!=g.templates&&!g.currentValue.template,value:g.currentValue.networkInterface,"onUpdate:value":t[7]||(t[7]=e=>g.currentValue.networkInterface=e),options:w.networkInterfaceSelectOptions,"label-key":"cluster.machineConfig.pve.template.network.label","tooltip-key":"cluster.machineConfig.pve.template.network.tooltip",required:""},null,8,["mode","disabled","value","options"]))])]),(0,r.createElementVNode)("h3",null,[(0,r.createVNode)(S,{k:"cluster.machineConfig.pve.hardware.header"})]),(0,r.createElementVNode)("div",m,[(0,r.createElementVNode)("div",d,[(0,r.createVNode)(I,{type:"number",mode:l.mode,disabled:w.disabled||null!=g.templates&&!g.currentValue.template,value:g.currentValue.processorSockets,"onUpdate:value":t[8]||(t[8]=e=>g.currentValue.processorSockets=e),"label-key":"cluster.machineConfig.pve.hardware.processorSockets.label",suffix:"sockets",min:"0",step:"1"},null,8,["mode","disabled","value"])]),(0,r.createElementVNode)("div",h,[(0,r.createVNode)(I,{type:"number",mode:l.mode,disabled:w.disabled||null!=g.templates&&!g.currentValue.template,value:g.currentValue.processorCores,"onUpdate:value":t[9]||(t[9]=e=>g.currentValue.processorCores=e),"label-key":"cluster.machineConfig.pve.hardware.processorCores.label",suffix:"cores",min:"0",step:"1"},null,8,["mode","disabled","value"])])]),(0,r.createElementVNode)("div",p,[(0,r.createElementVNode)("div",v,[(0,r.createVNode)(I,{type:"number",mode:l.mode,disabled:w.disabled||null!=g.templates&&!g.currentValue.template,value:g.currentValue.memory,"onUpdate:value":t[10]||(t[10]=e=>g.currentValue.memory=e),"label-key":"cluster.machineConfig.pve.hardware.memory.label",suffix:"MiB",min:"0",step:"256"},null,8,["mode","disabled","value"])])]),(0,r.createVNode)(E,{to:`advanced-${l.uuid}`},{default:(0,r.withCtx)(()=>[(0,r.createElementVNode)("h3",null,[(0,r.createVNode)(S,{k:"cluster.machineConfig.pve.memoryBalloon.header"})]),(0,r.createElementVNode)("div",V,[(0,r.createElementVNode)("div",f,[(0,r.createVNode)(I,{type:"number",mode:l.mode,disabled:w.disabled||null!=g.templates&&!g.currentValue.template,value:g.currentValue.memoryBalloon,"onUpdate:value":t[11]||(t[11]=e=>g.currentValue.memoryBalloon=e),"label-key":"cluster.machineConfig.pve.memoryBalloon.minimumMemory.label","tooltip-key":"cluster.machineConfig.pve.memoryBalloon.minimumMemory.tooltip",suffix:"MiB",min:"0",step:"256",max:""!=g.currentValue.memory?g.currentValue.memory:void 0},null,8,["mode","disabled","value","max"])])]),(0,r.createElementVNode)("h3",null,[(0,r.createVNode)(S,{k:"cluster.machineConfig.pve.ssh.header"})]),(0,r.createElementVNode)("div",y,[(0,r.createElementVNode)("div",k,[(0,r.createVNode)(P,{type:"text",mode:l.mode,value:g.currentValue.sshUser,"onUpdate:value":t[12]||(t[12]=e=>g.currentValue.sshUser=e),"label-key":"cluster.machineConfig.pve.ssh.username.label","tooltip-key":"cluster.machineConfig.pve.ssh.username.tooltip",required:""},null,8,["mode","value"])]),(0,r.createElementVNode)("div",b,[(0,r.createVNode)(P,{type:"number",mode:l.mode,value:g.currentValue.sshPort,"onUpdate:value":t[13]||(t[13]=e=>g.currentValue.sshPort=e),"label-key":"cluster.machineConfig.pve.ssh.port.label","tooltip-key":"cluster.machineConfig.pve.ssh.port.tooltip",required:"",min:"1",step:"1"},null,8,["mode","value"])])])]),_:1},8,["to"])])}var g=l(5664),w=l(4415),S=l(5533),P=l(5299),B=l(4364),I={components:{LabeledInput:w.o,LabeledSelect:S.A,UnitInput:P.A},props:{uuid:{type:String,required:!0},mode:{type:String,required:!0},value:{type:Object,required:!0},credentialId:{type:String,required:!0}},data(){return{fetchingCount:0,credential:null,resourcePools:null,templates:null,devices:null,currentValue:{resourcePool:this.value.resourcePool??"",template:this.value.template?parseInt(this.value.template):0,isoDevice:this.value.isoDevice??"",networkInterface:this.value.networkInterface??"",sshUser:this.value.sshUser?this.value.sshUser:"service",sshPort:this.value.sshPort?parseInt(this.value.sshPort):22,processorSockets:this.value.processorSockets?parseInt(this.value.processorSockets):"",processorCores:this.value.processorCores?parseInt(this.value.processorCores):"",memory:this.value.memory?parseInt(this.value.memory):"",memoryBalloon:this.value.memoryBalloon?parseInt(this.value.memoryBalloon):""}}},created(){this.validate()},async fetch(){await this.fetchCredential(),await this.fetchResourcePools(),await this.fetchTemplates(),await this.fetchDevices()},watch:{async credentialId(){await this.$fetch(),this.validate()},"currentValue.resourcePool":async function(){await this.fetchTemplates(),await this.fetchDevices()},"currentValue.template":async function(){await Promise.all([this.fetchDevices(),this.fetchHardware()])},"currentValue.memory":function(e,t){0!=this.currentValue.memoryBalloon&&(t==this.currentValue.memoryBalloon||e<this.currentValue.memoryBalloon)&&(this.currentValue.memoryBalloon=e)},currentValue:{deep:!0,handler(){this.validate()}},resourcePools(){null!=this.resourcePools&&(1==this.resourcePools.length&&(this.currentValue.resourcePool=this.resourcePools[0]),this.resourcePools.includes(this.currentValue.resourcePool)||(this.currentValue.resourcePool=""))},templates(){if(null==this.templates)return;1==this.templates.length&&(this.currentValue.template=this.templates[0].vmid);const e=this.templates.find(e=>this.currentValue.template==e.vmid);e||(this.currentValue.template=0)},isoDeviceSelectOptions(){null!=this.isoDeviceSelectOptions&&(1==this.isoDeviceSelectOptions.length&&(this.currentValue.isoDevice=this.isoDeviceSelectOptions[0]),this.isoDeviceSelectOptions.includes(this.currentValue.isoDevice)||(this.currentValue.isoDevice=""))},networkInterfaceSelectOptions(){null!=this.networkInterfaceSelectOptions&&(1==this.networkInterfaceSelectOptions.length&&(this.currentValue.networkInterface=this.networkInterfaceSelectOptions[0]),this.networkInterfaceSelectOptions.includes(this.currentValue.networkInterface)||(this.currentValue.networkInterface=""))}},methods:{validate(){null!==this.currentValue.processorSockets&&0!==this.currentValue.processorSockets||(this.currentValue.processorSockets=""),null!==this.currentValue.processorCores&&0!==this.currentValue.processorCores||(this.currentValue.processorCores=""),null!==this.currentValue.memory&&0!==this.currentValue.memory||(this.currentValue.memory=""),null===this.currentValue.memoryBalloon&&(this.currentValue.memoryBalloon=""),""!=this.currentValue.resourcePool?this.currentValue.template<1?this.$emit("validationChanged",!1):""!=this.currentValue.isoDevice&&""!=this.currentValue.networkInterface&&""!=this.currentValue.sshUser?this.currentValue.sshPort<1||""!=this.currentValue.processorSockets&&this.currentValue.processorSockets<1||""!=this.currentValue.processorCores&&this.currentValue.processorCores<1||""!=this.currentValue.memory&&this.currentValue.memory<1||""!=this.currentValue.memoryBalloon&&this.currentValue.memoryBalloon<0||""!=this.currentValue.memory&&""!=this.currentValue.memoryBalloon&&this.currentValue.memory<this.currentValue.memoryBalloon?this.$emit("validationChanged",!1):(this.value.resourcePool=this.currentValue.resourcePool,this.value.template=this.currentValue.template.toString(),this.value.isoDevice=this.currentValue.isoDevice,this.value.networkInterface=this.currentValue.networkInterface,this.value.sshUser=this.currentValue.sshUser,this.value.sshPort=this.currentValue.sshPort.toString(),this.value.processorSockets=this.currentValue.processorSockets.toString(),this.value.processorCores=this.currentValue.processorCores.toString(),this.value.memory=this.currentValue.memory.toString(),this.value.memoryBalloon=this.currentValue.memoryBalloon.toString(),this.$emit("validationChanged",!0)):this.$emit("validationChanged",!1):this.$emit("validationChanged",!1)},async fetchCredential(){try{this.fetchingCount+=1;const e=await this.$store.dispatch("management/find",{type:g.bB,id:this.credentialId.replace(":","/")}),t={url:atob(e.data["pvecredentialConfig-url"]),insecureTls:"true"==atob(e.data["pvecredentialConfig-insecureTls"]),tokenId:atob(e.data["pvecredentialConfig-tokenId"]),tokenSecret:atob(e.data["pvecredentialConfig-tokenSecret"])};if(t.insecureTls)throw new Error("Insecure TLS is enabled");this.credential=t}catch(e){B.warn("Failed to fetch Proxmox VE credential, enhanced form fields are disabled",e),this.credential=null}finally{this.fetchingCount-=1}},async fetchResourcePools(){try{this.fetchingCount+=1;const{data:e}=await this.fetchFromProxmox("/api2/json/pools");this.resourcePools=e.map(e=>e.poolid)}catch(e){this.resourcePools=null}finally{this.fetchingCount-=1}},async fetchTemplates(){if(null!=this.credential)if(this.resourcePools&&""==this.currentValue.resourcePool)this.templates=[];else try{if(this.fetchingCount+=1,!this.currentValue.resourcePool)throw new Error("Resource pool is not selected");const{data:e}=await this.fetchFromProxmox(`/api2/json/pools?type=qemu&poolid=${this.currentValue.resourcePool}`);this.templates=e[0].members.filter(e=>1==e.template)}catch(e){this.templates=null}finally{this.fetchingCount-=1}else this.templates=null},async fetchDevices(){if(null!=this.credential)if(this.templates&&""==this.currentValue.template)this.devices=[];else try{if(this.fetchingCount+=1,!this.currentValue.template)throw new Error("Template is not selected");const e=this.templates.find(e=>this.currentValue.template==e.vmid);if(!e)throw new Error("Template not found");const{data:t}=await this.fetchFromProxmox(`/api2/json/nodes/${e.node}/qemu/${e.vmid}/pending`);this.devices=t}catch(e){this.devices=null}finally{this.fetchingCount-=1}else this.devices=null},async fetchHardware(){if(null!=this.credential&&(!this.templates||""!=this.currentValue.template))try{if(this.fetchingCount+=1,!this.currentValue.template)throw new Error("Template is not selected");const e=this.templates.find(e=>this.currentValue.template==e.vmid);if(!e)throw new Error("Template not found");const{data:t}=await this.fetchFromProxmox(`/api2/json/nodes/${e.node}/qemu/${e.vmid}/config`);this.currentValue.processorSockets=t.sockets,this.currentValue.processorCores=t.cores,this.currentValue.memory=t.memory,this.currentValue.memoryBalloon=t.memory}catch(e){this.currentValue.processorSockets="",this.currentValue.processorCores="",this.currentValue.memory="",this.currentValue.memoryBalloon=""}finally{this.fetchingCount-=1}},fetchFromProxmox(e){if(null==this.credential)throw new Error("Credential not available");return this.$store.dispatch("management/request",{method:"GET",url:"/meta/proxy/"+this.credential.url.replace(/^https?:\/\//,"")+e,headers:{"X-API-Auth-Header":`PVEAPIToken=${this.credential.tokenId}=${this.credential.tokenSecret}`},redirectUnauthorized:!1})},selectTemplate(e){if(0!=Object.keys(this.templateSelectOptions).length){for(const[t,l]of Object.entries(this.templateSelectOptions))if(e==l)return void(this.currentValue.template=t);this.currentValue.template=0}else this.currentValue.template=0}},computed:{disabled(){return this.fetchingCount>0},templateSelectOptions(){return null===this.templates?{}:this.templates.reduce((e,t)=>({...e,[t.vmid]:`${t.name} (${t.vmid})`}),{})},templateSelectValue(){return this.templateSelectOptions[this.currentValue.template]??""},isoDeviceSelectOptions(){return null==this.devices?null:this.devices.filter(e=>e.key).filter(e=>e.value&&"string"==typeof e.value).filter(e=>e.value.includes("media=cdrom")).map(e=>e.key)},networkInterfaceSelectOptions(){return null==this.devices?null:this.devices.filter(e=>e.key).filter(e=>e.key.startsWith("net")).map(e=>e.key)}}},E=l(7433);const N=(0,E.A)(I,[["render",C]]);var D=N}}]);
//# sourceMappingURL=pve-node-driver-1.1.0-rc1.umd.min.machine-config.js.map